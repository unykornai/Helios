{% extends "base.html" %}
{% block title %}Ask Helios â€” AI Intelligence Hub{% endblock %}
{% block og_title %}Ask Helios â€” AI Intelligence Hub{% endblock %}
{% block og_description %}Your personal AI advisor for the Helios protocol. Real-time answers on smart contracts, gold reserves, tokenomics, allocation formulas, and Web3 infrastructure.{% endblock %}
{% block og_url %}/ask{% endblock %}

{% block head %}
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ASK HELIOS â€” THE INTELLIGENCE HUB
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”€â”€ Hero Oracle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.ask-hero {
    text-align: center;
    padding: 3rem 0 2rem;
    position: relative;
}
.oracle-container {
    position: relative;
    width: 180px; height: 180px;
    margin: 0 auto 1.5rem;
    cursor: pointer;
}
.oracle-glow {
    position: absolute; inset: -20px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(41,151,255,0.15) 0%, transparent 70%);
    animation: oracle-breathe 4s ease-in-out infinite;
}
@keyframes oracle-breathe {
    0%,100% { opacity: .4; transform: scale(.95); }
    50% { opacity: .8; transform: scale(1.05); }
}
.oracle-ring {
    position: absolute; inset: 0;
    border-radius: 50%;
    border: 1.5px solid rgba(41,151,255,0.2);
    animation: oracle-ring-spin 20s linear infinite;
}
.oracle-ring::before {
    content: ''; position: absolute;
    top: -3px; left: 50%; width: 6px; height: 6px;
    border-radius: 50%; background: var(--primary);
    box-shadow: 0 0 12px var(--primary);
}
@keyframes oracle-ring-spin { to { transform: rotate(360deg); } }
.oracle-ring-outer {
    position: absolute; inset: -12px;
    border-radius: 50%;
    border: 1px solid rgba(41,151,255,0.08);
    animation: oracle-ring-spin 30s linear infinite reverse;
}
.oracle-ring-outer::before {
    content: ''; position: absolute;
    top: -2px; left: 50%; width: 4px; height: 4px;
    border-radius: 50%; background: rgba(41,151,255,0.4);
}
.oracle-core {
    position: absolute; inset: 30px;
    border-radius: 50%;
    background: radial-gradient(circle at 40% 35%, rgba(41,151,255,0.25), rgba(41,151,255,0.05));
    backdrop-filter: blur(20px);
    border: 1px solid rgba(41,151,255,0.15);
    display: flex; align-items: center; justify-content: center;
    font-size: 2.5rem;
    transition: all .3s;
}
.oracle-core:hover { border-color: rgba(41,151,255,0.4); }
.oracle-core .oracle-icon { animation: oracle-pulse 3s ease-in-out infinite; }
@keyframes oracle-pulse {
    0%,100% { transform: scale(1); filter: brightness(1); }
    50% { transform: scale(1.08); filter: brightness(1.3); }
}

/* Oracle states */
.oracle-speaking .oracle-glow { animation: oracle-speak-glow .6s ease-in-out infinite; }
@keyframes oracle-speak-glow {
    0%,100% { opacity: .5; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.1); }
}
.oracle-thinking .oracle-core { animation: oracle-think 1.5s ease-in-out infinite; }
@keyframes oracle-think {
    0%,100% { opacity: .6; }
    50% { opacity: 1; }
}

.ask-title {
    font-size: 2.2rem; font-weight: 700;
    background: linear-gradient(135deg, var(--chrome), var(--primary));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    margin-bottom: .4rem;
}
.ask-subtitle {
    font-size: 1rem; color: var(--text-muted);
    max-width: 540px; margin: 0 auto .5rem;
    line-height: 1.5;
}
.ask-badge {
    display: inline-flex; align-items: center; gap: .4rem;
    padding: .3rem .8rem; border-radius: 20px;
    background: rgba(41,151,255,0.06);
    border: 1px solid rgba(41,151,255,0.12);
    font-size: .72rem; font-weight: 600;
    color: var(--primary); text-transform: uppercase;
    letter-spacing: .08em; margin-top: .5rem;
}
.ask-badge .pulse-dot {
    width: 6px; height: 6px; border-radius: 50%;
    background: #34d399; animation: pulse-dot 2s ease-in-out infinite;
}
@keyframes pulse-dot {
    0%,100% { opacity: .4; transform: scale(.8); }
    50% { opacity: 1; transform: scale(1.2); }
}

/* â”€â”€ Voice Toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.voice-toggle-wrap { display: flex; justify-content: center; margin-bottom: 1.8rem; }
.voice-toggle-bar {
    display: inline-flex; align-items: center; gap: .8rem;
    padding: .45rem 1rem; border-radius: 20px;
    background: var(--bg-card); border: 1px solid var(--border);
}
.voice-toggle-label { font-size: .78rem; color: var(--text-muted); font-weight: 600; }
.voice-toggle {
    width: 36px; height: 20px; border-radius: 10px;
    background: var(--border); position: relative;
    cursor: pointer; transition: background .3s;
}
.voice-toggle.active { background: var(--primary); }
.voice-toggle::after {
    content: ''; position: absolute; top: 2px; left: 2px;
    width: 16px; height: 16px; border-radius: 50%;
    background: white; transition: transform .3s;
}
.voice-toggle.active::after { transform: translateX(16px); }

/* â”€â”€ Topic Categories â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.topic-categories { margin-bottom: 2rem; }
.category-header {
    display: flex; align-items: center; gap: .5rem;
    margin-bottom: .75rem; padding-bottom: .4rem;
    border-bottom: 1px solid rgba(41,151,255,0.08);
}
.category-icon {
    width: 28px; height: 28px; border-radius: 8px;
    background: rgba(41,151,255,0.08);
    display: flex; align-items: center; justify-content: center;
    font-size: .8rem;
}
.category-label {
    font-size: .72rem; text-transform: uppercase;
    letter-spacing: .1em; font-weight: 700;
    color: var(--text-muted);
}
.topic-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: .55rem; margin-bottom: 1.5rem;
}
.topic-card {
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: var(--radius); padding: .7rem .9rem;
    cursor: pointer; transition: all .25s;
    display: flex; align-items: center; gap: .6rem;
    position: relative; overflow: hidden;
}
.topic-card::before {
    content: ''; position: absolute; inset: 0;
    background: linear-gradient(135deg, rgba(41,151,255,0.04), transparent);
    opacity: 0; transition: opacity .25s;
}
.topic-card:hover::before { opacity: 1; }
.topic-card:hover {
    border-color: rgba(41,151,255,0.25);
    transform: translateY(-1px);
    box-shadow: 0 4px 20px rgba(41,151,255,0.06);
}
.topic-marker {
    width: 34px; height: 34px; border-radius: 10px;
    background: rgba(41,151,255,0.06); border: 1px solid rgba(41,151,255,0.12);
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0; font-size: .85rem;
}
.topic-text { font-size: .85rem; font-weight: 600; color: var(--text); line-height: 1.3; }
.topic-sub { font-size: .7rem; color: var(--text-muted); font-weight: 400; margin-top: .1rem; }

/* â”€â”€ Chat Container â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.chat-wrapper {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    margin-bottom: 1.5rem;
}
.chat-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: .6rem 1rem;
    background: rgba(41,151,255,0.03);
    border-bottom: 1px solid var(--border);
}
.chat-header-left { display: flex; align-items: center; gap: .5rem; }
.chat-header-dot {
    width: 8px; height: 8px; border-radius: 50%;
    background: #34d399; animation: pulse-dot 2s ease-in-out infinite;
}
.chat-header-title { font-size: .78rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: .08em; }
.chat-header-clear {
    font-size: .72rem; color: var(--text-muted); cursor: pointer;
    padding: .2rem .5rem; border-radius: 8px; border: 1px solid var(--border);
    background: none; transition: all .2s;
}
.chat-header-clear:hover { border-color: var(--primary); color: var(--primary); }
.chat-messages {
    max-height: 500px; overflow-y: auto;
    padding: 1rem; scroll-behavior: smooth;
}
.chat-message {
    display: flex; gap: .75rem; margin-bottom: 1rem;
    animation: msgFadeIn .35s ease;
}
@keyframes msgFadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
}
.chat-message.user { flex-direction: row-reverse; }
.msg-avatar {
    width: 34px; height: 34px; border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: .8rem; flex-shrink: 0;
    font-weight: 700; color: var(--primary);
}
.chat-message.assistant .msg-avatar {
    background: rgba(41,151,255,0.08); border: 1px solid rgba(41,151,255,0.12);
}
.chat-message.user .msg-avatar {
    background: rgba(74,126,181,0.08); border: 1px solid rgba(74,126,181,0.12);
    color: var(--text-muted);
}
.msg-content {
    max-width: 80%; padding: .75rem 1rem;
    border-radius: var(--radius);
    font-size: .92rem; line-height: 1.65;
}
.chat-message.assistant .msg-content {
    background: rgba(41,151,255,0.03);
    border: 1px solid rgba(41,151,255,0.08);
    color: var(--text);
}
.chat-message.user .msg-content {
    background: rgba(74,126,181,0.06);
    border: 1px solid rgba(74,126,181,0.1);
    color: var(--text);
}
.msg-content p { margin: 0; }
.voice-btn {
    background: none; border: none; cursor: pointer;
    font-size: 1rem; margin-top: .4rem; padding: .2rem;
    opacity: .5; transition: opacity .2s;
}
.voice-btn:hover { opacity: 1; }
.voice-btn.playing { opacity: 1; color: var(--primary); }
.follow-up {
    display: flex; flex-wrap: wrap; gap: .4rem;
    padding: .5rem 1rem .75rem;
}
.follow-btn {
    background: var(--bg); border: 1px solid var(--border);
    border-radius: 16px; padding: .3rem .8rem;
    font-size: .73rem; color: var(--text-muted);
    cursor: pointer; transition: all .2s;
}
.follow-btn:hover {
    border-color: var(--primary); color: var(--primary);
    background: rgba(41,151,255,0.03);
}
.chat-input-area {
    display: flex; gap: .5rem;
    padding: .75rem 1rem;
    border-top: 1px solid var(--border);
    background: rgba(0,0,0,0.2);
}
.chat-input-area input {
    flex: 1; padding: .7rem 1rem;
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: var(--radius); color: var(--text);
    font-size: .92rem; font-family: 'EB Garamond', serif;
}
.chat-input-area input:focus {
    outline: none; border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(41,151,255,0.08);
}
.chat-input-area input::placeholder { color: var(--text-muted); opacity: .6; }

/* â”€â”€ Context Awareness Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.context-bar {
    display: flex; flex-wrap: wrap; gap: .5rem;
    justify-content: center; margin-top: 1.5rem;
    padding-top: 1rem; border-top: 1px solid var(--border);
}
.context-chip {
    display: flex; align-items: center; gap: .3rem;
    padding: .3rem .7rem; border-radius: 20px;
    font-size: .7rem; font-weight: 600; color: var(--text-muted);
    border: 1px solid var(--border); background: var(--bg-card);
    text-decoration: none; transition: all .2s;
}
.context-chip:hover { border-color: var(--primary); color: var(--primary); }
.context-chip .chip-icon { font-size: .75rem; }

/* â”€â”€ Capabilities Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.capabilities {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
    gap: .75rem; margin: 1.5rem 0;
}
.capability-card {
    text-align: center; padding: 1.2rem .8rem;
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: var(--radius); transition: all .25s;
}
.capability-card:hover {
    border-color: rgba(41,151,255,0.2);
    transform: translateY(-2px);
}
.capability-icon { font-size: 1.5rem; margin-bottom: .5rem; }
.capability-title { font-size: .82rem; font-weight: 700; color: var(--text); margin-bottom: .25rem; }
.capability-desc { font-size: .7rem; color: var(--text-muted); line-height: 1.4; }

/* â”€â”€ No floating AI on /ask page (already here) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.helios-fab { display: none !important; }
</style>
{% endblock %}

{% block content %}
<section class="section">
    <div class="container" style="max-width: 820px;">

        <!-- â•â•â• ORACLE HERO â•â•â• -->
        <div class="ask-hero">
            <div class="oracle-container" id="helios-oracle" title="Tap to replay last response">
                <div class="oracle-glow"></div>
                <div class="oracle-ring-outer"></div>
                <div class="oracle-ring"></div>
                <div class="oracle-core">
                    <span class="oracle-icon">â˜€ï¸</span>
                </div>
            </div>
            <h1 class="ask-title">Ask Helios</h1>
            <p class="ask-subtitle">
                Your personal AI advisor. Protocol mechanics, allocation math,
                gold reserves, smart contracts â€” I'll explain it. You decide.
            </p>
            <div class="ask-badge">
                <span class="pulse-dot"></span>
                <span id="oracle-status">Intelligence Hub Active</span>
            </div>
        </div>

        <!-- â•â•â• VOICE TOGGLE â•â•â• -->
        <div class="voice-toggle-wrap">
            <div class="voice-toggle-bar">
                <span class="voice-toggle-label">Text</span>
                <div class="voice-toggle active" id="voiceToggle" onclick="toggleVoice()"></div>
                <span class="voice-toggle-label">Voice</span>
            </div>
        </div>

        <!-- â•â•â• WHAT I CAN DO â•â•â• -->
        <div class="capabilities">
            <div class="capability-card">
                <div class="capability-icon">âš¡</div>
                <div class="capability-title">Smart Contracts</div>
                <div class="capability-desc">Allocation engine, propagation formula, depth mechanics</div>
            </div>
            <div class="capability-card">
                <div class="capability-icon">ğŸª™</div>
                <div class="capability-title">Gold &amp; Reserves</div>
                <div class="capability-desc">Physical gold, APMEX, NFT certificates, redemption</div>
            </div>
            <div class="capability-card">
                <div class="capability-icon">ğŸ“Š</div>
                <div class="capability-title">Tokenomics</div>
                <div class="capability-desc">HLS token, burns, staking, exchange mechanics</div>
            </div>
            <div class="capability-card">
                <div class="capability-icon">ğŸ”—</div>
                <div class="capability-title">Web3 Infrastructure</div>
                <div class="capability-desc">XRPL, Stellar, .helios identity, proof chains</div>
            </div>
        </div>

        <!-- â•â•â• TOPIC CATEGORIES â•â•â• -->
        <div class="topic-categories">

            <!-- Smart Contract Allocation -->
            <div class="category-header">
                <div class="category-icon">âš™ï¸</div>
                <span class="category-label">Smart Contract Allocation</span>
            </div>
            <div class="topic-grid">
                <div class="topic-card" onclick="askQuestion('How does the smart contract allocation engine work?')">
                    <div class="topic-marker">âš™ï¸</div>
                    <div><div class="topic-text">Allocation Engine</div><div class="topic-sub">Propagation across the connection mesh</div></div>
                </div>
                <div class="topic-card" onclick="askQuestion('Walk me through the activation fee â€” where does every dollar go?')">
                    <div class="topic-marker">$</div>
                    <div><div class="topic-text">Fee Breakdown</div><div class="topic-sub">Complete dollar-by-dollar allocation</div></div>
                </div>
                <div class="topic-card" onclick="askQuestion('Explain the propagation formula W_h = W_1 times r to the power of h minus 1.')">
                    <div class="topic-marker">W</div>
                    <div><div class="topic-text">Weighting Formula</div><div class="topic-sub">W<sub>h</sub> = W<sub>1</sub> Â· r<sup>(hâˆ’1)</sup></div></div>
                </div>
                <div class="topic-card" onclick="askQuestion('What are the five contract levels and how do allocations scale?')">
                    <div class="topic-marker">ğŸ“‹</div>
                    <div><div class="topic-text">Contract Levels</div><div class="topic-sub">$100 â†’ $250 â†’ $500 â†’ $1K â†’ $5K</div></div>
                </div>
            </div>

            <!-- Gold & Treasury -->
            <div class="category-header">
                <div class="category-icon">ğŸª™</div>
                <span class="category-label">Gold, Certificates &amp; Treasury</span>
            </div>
            <div class="topic-grid">
                <div class="topic-card" onclick="askQuestion('How does the gold backing work? Physical gold through APMEX?')">
                    <div class="topic-marker">ğŸª™</div>
                    <div><div class="topic-text">Gold Backing</div><div class="topic-sub">Physical metal reserves via APMEX</div></div>
                </div>
                <div class="topic-card" onclick="askQuestion('What are the three certificate types? Gold, Welcome, and Staking?')">
                    <div class="topic-marker">ğŸ“œ</div>
                    <div><div class="topic-text">Certificate Classes</div><div class="topic-sub">Gold, Welcome, Staking NFTs</div></div>
                </div>
                <div class="topic-card" onclick="askQuestion('How do I redeem certificates for physical gold or convert to stablecoin?')">
                    <div class="topic-marker">â™»ï¸</div>
                    <div><div class="topic-text">Redemption</div><div class="topic-sub">Physical metal or USDC conversion</div></div>
                </div>
                <div class="topic-card" onclick="askQuestion('How does certificate staking work? What are the reward tiers?')">
                    <div class="topic-marker">ğŸ“ˆ</div>
                    <div><div class="topic-text">Staking Rewards</div><div class="topic-sub">5% â†’ 12% â†’ 20% â†’ 30% tiers</div></div>
                </div>
            </div>

            <!-- Web3 & Blockchain -->
            <div class="category-header">
                <div class="category-icon">ğŸ”—</div>
                <span class="category-label">Web3 &amp; Blockchain Infrastructure</span>
            </div>
            <div class="topic-grid">
                <div class="topic-card" onclick="askQuestion('How does Helios use XRPL and Stellar? What role does each blockchain play?')">
                    <div class="topic-marker">ğŸ”—</div>
                    <div><div class="topic-text">XRPL &amp; Stellar</div><div class="topic-sub">Dual-chain settlement</div></div>
                </div>
                <div class="topic-card" onclick="askQuestion('What is the .helios namespace and how does member identity work on-chain?')">
                    <div class="topic-marker">.h</div>
                    <div><div class="topic-text">.helios Identity</div><div class="topic-sub">Decentralized namespace</div></div>
                </div>
                <div class="topic-card" onclick="askQuestion('How is the SHA-256 proof chain created from physical gold to digital certificate?')">
                    <div class="topic-marker">ğŸ”’</div>
                    <div><div class="topic-text">Proof Chain</div><div class="topic-sub">Gold â†’ IPFS â†’ XRPL verification</div></div>
                </div>
                <div class="topic-card" onclick="askQuestion('What crypto assets are available? BTC, ETH, XRP, stablecoins?')">
                    <div class="topic-marker">ğŸ’±</div>
                    <div><div class="topic-text">Crypto Access</div><div class="topic-sub">BTC, ETH, XRP, XLM, USDC, USDT</div></div>
                </div>
            </div>

            <!-- Tokenomics & HLS -->
            <div class="category-header">
                <div class="category-icon">ğŸ“Š</div>
                <span class="category-label">Tokenomics &amp; HLS Token</span>
            </div>
            <div class="topic-grid">
                <div class="topic-card" onclick="askQuestion('What is the HLS token and how does it work within the protocol?')">
                    <div class="topic-marker">ğŸŒŸ</div>
                    <div><div class="topic-text">HLS Token</div><div class="topic-sub">Utility, governance, value</div></div>
                </div>
                <div class="topic-card" onclick="askQuestion('How do token burns work? What triggers a burn event?')">
                    <div class="topic-marker">ğŸ”¥</div>
                    <div><div class="topic-text">Burn Mechanics</div><div class="topic-sub">Deflationary supply dynamics</div></div>
                </div>
                <div class="topic-card" onclick="askQuestion('What is the Founding Window and the 10x token multiplier?')">
                    <div class="topic-marker">â³</div>
                    <div><div class="topic-text">Founding Window</div><div class="topic-sub">10Ã— multiplier until Mar 31</div></div>
                </div>
                <div class="topic-card" onclick="askQuestion('How does the internal HLS marketplace and exchange work?')">
                    <div class="topic-marker">ğŸª</div>
                    <div><div class="topic-text">Marketplace</div><div class="topic-sub">Internal exchange mechanics</div></div>
                </div>
            </div>

            <!-- Getting Started -->
            <div class="category-header">
                <div class="category-icon">ğŸš€</div>
                <span class="category-label">Getting Started</span>
            </div>
            <div class="topic-grid">
                <div class="topic-card" onclick="askQuestion('I am new. Walk me through how Helios works from the beginning.')">
                    <div class="topic-marker">ğŸ‘‹</div>
                    <div><div class="topic-text">New Member Guide</div><div class="topic-sub">Complete walkthrough from zero</div></div>
                </div>
                <div class="topic-card" onclick="askQuestion('What makes Helios different from other crypto or gold platforms?')">
                    <div class="topic-marker">ğŸ’</div>
                    <div><div class="topic-text">Why Helios?</div><div class="topic-sub">What sets this apart</div></div>
                </div>
                <div class="topic-card" onclick="askQuestion('What structural safeguards prevent protocol misuse or fund misappropriation?')">
                    <div class="topic-marker">ğŸ›¡ï¸</div>
                    <div><div class="topic-text">Safeguards</div><div class="topic-sub">Structural integrity protections</div></div>
                </div>
                <div class="topic-card" onclick="askQuestion('How do I activate a contract and start building my connection mesh?')">
                    <div class="topic-marker">âš¡</div>
                    <div><div class="topic-text">Activate Now</div><div class="topic-sub">Step-by-step activation</div></div>
                </div>
            </div>
        </div>

        <!-- â•â•â• CHAT INTERFACE â•â•â• -->
        <div class="chat-wrapper">
            <div class="chat-header">
                <div class="chat-header-left">
                    <div class="chat-header-dot"></div>
                    <span class="chat-header-title">Helios Intelligence</span>
                </div>
                <button class="chat-header-clear" onclick="clearChat()">Clear</button>
            </div>
            <div id="chat-messages" class="chat-messages">
                <div class="chat-message assistant">
                    <div class="msg-avatar">â˜€ï¸</div>
                    <div class="msg-content">
                        <p>Welcome to Ask Helios â€” your AI advisor for the entire protocol.<br><br>
                        I know the smart contract allocation engine inside and out â€” the propagation formula,
                        every contract level, the gold reserve pipeline, certificate classes, staking tiers,
                        XRPL/Stellar settlement, and tokenomics.<br><br>
                        <strong>Select any topic above</strong>, or ask me anything directly.
                        I'll explain it. You decide.</p>
                    </div>
                </div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="chat-input"
                    placeholder="Ask about contracts, gold, tokenomics, allocation formula..."
                    class="input-large" autocomplete="off">
                <button id="chat-send" class="btn btn-primary">Ask</button>
            </div>
        </div>

        <!-- â•â•â• CONTEXT AWARENESS BAR â•â•â• -->
        <div class="context-bar">
            <a href="/earnings" class="context-chip"><span class="chip-icon">âš¡</span> Allocation Model</a>
            <a href="/certificates" class="context-chip"><span class="chip-icon">ğŸ“œ</span> Certificates</a>
            <a href="/treasury" class="context-chip"><span class="chip-icon">ğŸ¦</span> Treasury</a>
            <a href="/vault/gold" class="context-chip"><span class="chip-icon">ğŸª™</span> Gold Reserve</a>
            <a href="/tokenomics" class="context-chip"><span class="chip-icon">ğŸ“Š</span> Tokenomics</a>
            <a href="/metrics" class="context-chip"><span class="chip-icon">ğŸ“‰</span> Protocol Metrics</a>
            <a href="/launch" class="context-chip"><span class="chip-icon">ğŸš€</span> Token Launch</a>
            <a href="/activate" class="context-chip"><span class="chip-icon">ğŸ”‘</span> Activate</a>
        </div>

    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ASK HELIOS â€” INTELLIGENCE ENGINE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

var memberId = localStorage.getItem('helios_id') || null;
var chatMessages = document.getElementById('chat-messages');
var chatInput = document.getElementById('chat-input');
var chatSend = document.getElementById('chat-send');
var oracle = document.getElementById('helios-oracle');
var oracleStatus = document.getElementById('oracle-status');

var currentAudio = null;
var lastAnswer = null;
var voiceEnabled = true;

// â•â•â• Voice Toggle â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleVoice() {
    var toggle = document.getElementById('voiceToggle');
    voiceEnabled = !voiceEnabled;
    toggle.classList.toggle('active', voiceEnabled);
    oracleStatus.textContent = voiceEnabled ? 'Voice Advisory Active' : 'Text Mode Active';
}

// â•â•â• Oracle State Machine â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setOracleState(state) {
    oracle.classList.remove('oracle-speaking', 'oracle-thinking');
    if (state === 'speaking') {
        oracle.classList.add('oracle-speaking');
        oracleStatus.textContent = 'Speaking â€” Tap to pause';
    } else if (state === 'thinking') {
        oracle.classList.add('oracle-thinking');
        oracleStatus.textContent = 'Processingâ€¦';
    } else {
        oracleStatus.textContent = voiceEnabled
            ? (lastAnswer ? 'Tap oracle to hear again' : 'Intelligence Hub Active')
            : 'Text Mode Active';
    }
}

// Tap oracle to replay / stop
oracle.addEventListener('click', function() {
    if (currentAudio) {
        currentAudio.pause();
        currentAudio = null;
        setOracleState('idle');
        return;
    }
    if (lastAnswer && voiceEnabled) {
        speakText(null, lastAnswer);
    }
});

// â•â•â• Chat Functions â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addMessage(role, text, showVoice) {
    var div = document.createElement('div');
    div.className = 'chat-message ' + role;

    var voiceHtml = '';
    if (role === 'assistant' && showVoice && voiceEnabled) {
        voiceHtml = '<button class="voice-btn" title="Listen">&#128266;</button>';
    }

    div.innerHTML =
        '<div class="msg-avatar">' + (role === 'assistant' ? 'â˜€ï¸' : 'ğŸ‘¤') + '</div>' +
        '<div class="msg-content">' +
            '<p>' + text.replace(/\n/g, '<br>') + '</p>' +
            voiceHtml +
        '</div>';

    if (role === 'assistant' && showVoice) {
        lastAnswer = text;
        var voiceBtn = div.querySelector('.voice-btn');
        if (voiceBtn) {
            voiceBtn.addEventListener('click', function() { speakText(this, text); });
        }
    }

    chatMessages.appendChild(div);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function clearChat() {
    chatMessages.innerHTML = '';
    addMessage('assistant',
        'Chat cleared. Ask me anything about the Helios protocol â€” ' +
        'smart contracts, gold reserves, tokenomics, certificates, or Web3 infrastructure.', false);
}

async function speakText(btn, text) {
    if (currentAudio) {
        currentAudio.pause();
        currentAudio = null;
        document.querySelectorAll('.voice-btn.playing').forEach(function(b) {
            b.classList.remove('playing');
            b.innerHTML = '&#128266;';
        });
        setOracleState('idle');
        return;
    }

    if (btn) { btn.classList.add('playing'); btn.innerHTML = '&#8987;'; }
    setOracleState('speaking');

    try {
        var res = await fetch('/api/voice/speak', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({text: text})
        }).then(function(r) { return r.json(); });

        if (res.success && res.data && res.data.audio) {
            var audioData = 'data:audio/mpeg;base64,' + res.data.audio;
            currentAudio = new Audio(audioData);
            if (btn) btn.innerHTML = '&#9208;&#65039;';
            currentAudio.onended = function() {
                if (btn) { btn.classList.remove('playing'); btn.innerHTML = '&#128266;'; }
                currentAudio = null;
                setOracleState('idle');
            };
            currentAudio.onerror = function() {
                if (btn) { btn.classList.remove('playing'); btn.innerHTML = '&#128266;'; }
                currentAudio = null;
                setOracleState('idle');
            };
            currentAudio.play();
        } else {
            if (btn) { btn.classList.remove('playing'); btn.innerHTML = '&#128263;'; setTimeout(function() { btn.innerHTML = '&#128266;'; }, 2000); }
            setOracleState('idle');
        }
    } catch (err) {
        if (btn) { btn.classList.remove('playing'); btn.innerHTML = '&#128263;'; setTimeout(function() { btn.innerHTML = '&#128266;'; }, 2000); }
        setOracleState('idle');
    }
}

async function askQuestion(question) {
    if (!question.trim()) return;

    addMessage('user', question);
    chatInput.value = '';
    setOracleState('thinking');

    var typing = document.createElement('div');
    typing.className = 'chat-message assistant typing';
    typing.innerHTML = '<div class="msg-avatar">â˜€ï¸</div><div class="msg-content"><p>Processingâ€¦</p></div>';
    chatMessages.appendChild(typing);
    chatMessages.scrollTop = chatMessages.scrollHeight;

    try {
        var res = await fetch('/api/chat/ask', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({question: question, member_id: memberId})
        }).then(function(r) { return r.json(); });

        typing.remove();
        setOracleState('idle');

        if (res.success) {
            addMessage('assistant', res.data.answer, true);

            if (res.data.follow_up && res.data.follow_up.length > 0) {
                var suggestions = document.createElement('div');
                suggestions.className = 'follow-up';
                suggestions.innerHTML = res.data.follow_up.map(function(q) {
                    return '<button class="follow-btn" onclick="askQuestion(\'' +
                        q.replace(/'/g, "\\'") + '\')">' + q + '</button>';
                }).join('');
                chatMessages.appendChild(suggestions);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            if (voiceEnabled) {
                speakText(null, res.data.answer);
            }
        } else {
            addMessage('assistant', 'Unable to process your inquiry at this time. Please try again.');
        }
    } catch(err) {
        typing.remove();
        setOracleState('idle');
        addMessage('assistant', 'Connection error. Please try again.');
    }
}

chatSend.addEventListener('click', function() { askQuestion(chatInput.value); });
chatInput.addEventListener('keypress', function(e) { if (e.key === 'Enter') askQuestion(chatInput.value); });

// â•â•â• Auto-greet with voice on first visit â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
    var greeted = sessionStorage.getItem('helios_ask_greeted');
    if (!greeted && voiceEnabled) {
        sessionStorage.setItem('helios_ask_greeted', '1');
        setTimeout(function() {
            var intro = "Welcome to Ask Helios. I'm your AI advisor for the entire protocol. " +
                "Smart contracts, gold reserves, tokenomics, allocation formulas â€” " +
                "ask me anything. I'll explain it. You decide.";
            speakText(null, intro);
        }, 1500);
    }
})();
</script>
{% endblock %}

