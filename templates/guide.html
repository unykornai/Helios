{% extends "base.html" %}
{% block title %}Helios â€” Your Personal Guide{% endblock %}
{% block og_title %}Helios â€” AI Guide & Member Intake{% endblock %}
{% block og_description %}Meet Helios â€” your personal guide to the smart contract allocation protocol. Voice-powered. Patient. Thorough. Ready to walk you through everything and get you started.{% endblock %}
{% block og_url %}/guide{% endblock %}

{% block head %}
<style>
/* â”€â”€â”€ Guide Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.guide-hero {
    text-align: center; padding: 2rem 0 1rem;
}
.guide-hero h1 {
    font-size: 2.2rem; font-weight: 600; color: var(--text);
    margin-bottom: .5rem;
}
.guide-hero h1 span { color: var(--gold); }
.guide-hero .guide-subtitle {
    font-size: 1.05rem; color: var(--text-muted); max-width: 520px;
    margin: 0 auto; line-height: 1.7;
}

/* â”€â”€â”€ Helios Avatar (Guide Persona) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.guide-avatar-wrap {
    display: flex; flex-direction: column; align-items: center;
    margin: 1.5rem 0 1rem;
}
.guide-avatar-ring {
    width: 160px; height: 160px; position: relative;
    cursor: pointer;
}
.guide-avatar-ring svg { width: 100%; height: 100%; }
.guide-avatar-ring:hover { transform: scale(1.02); transition: transform .3s; }
/* Pulse when speaking */
.guide-avatar-ring.speaking .ga-core { animation: ga-speak .6s ease-in-out infinite; }
.guide-avatar-ring.speaking .ga-rings circle { animation: ga-ring-pulse 1.2s ease-in-out infinite; }
.guide-avatar-ring.thinking .ga-core { animation: ga-think 2s ease-in-out infinite; }
@keyframes ga-speak {
    0%,100% { r: 22; opacity: .8; }
    25% { r: 26; opacity: 1; }
    50% { r: 20; opacity: .7; }
    75% { r: 27; opacity: .95; }
}
@keyframes ga-ring-pulse {
    0%,100% { stroke-width: 1.5; opacity: .3; }
    50% { stroke-width: 3; opacity: .55; }
}
@keyframes ga-think {
    0%,100% { r: 22; fill-opacity: .8; }
    50% { r: 16; fill-opacity: .4; }
}
.guide-persona-label {
    margin-top: .75rem; font-family: 'Inter', sans-serif;
    font-size: .78rem; text-transform: uppercase; letter-spacing: .15em;
    font-weight: 600; color: var(--text-muted); transition: color .3s;
}
.guide-persona-label.active { color: var(--gold); }
.guide-persona-status {
    font-family: 'Inter', sans-serif; font-size: .72rem;
    color: var(--text-muted); margin-top: .2rem; min-height: 1rem;
}

/* â”€â”€â”€ Voice Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.guide-voice-bar {
    display: flex; justify-content: center; margin: 1rem 0 1.5rem;
}
.guide-voice-toggle {
    display: inline-flex; align-items: center; gap: .8rem;
    padding: .45rem 1rem; border-radius: 20px;
    background: var(--bg-card); border: 1px solid var(--border);
    font-family: 'Inter', sans-serif;
}
.gv-label { font-size: .78rem; color: var(--text-muted); font-weight: 600; }
.gv-switch {
    width: 36px; height: 20px; border-radius: 10px;
    background: var(--border); position: relative;
    cursor: pointer; transition: background .3s;
}
.gv-switch.on { background: var(--gold); }
.gv-switch::after {
    content: ''; position: absolute; top: 2px; left: 2px;
    width: 16px; height: 16px; border-radius: 50%;
    background: white; transition: transform .3s;
}
.gv-switch.on::after { transform: translateX(16px); }

/* â”€â”€â”€ Mode Tabs (Guide / Intake) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.guide-mode-tabs {
    display: flex; justify-content: center; gap: .5rem;
    margin-bottom: 1.5rem;
}
.guide-mode-tab {
    padding: .5rem 1.5rem; border-radius: 20px; font-size: .82rem;
    font-weight: 600; font-family: 'Inter', sans-serif;
    background: var(--bg-card); border: 1px solid var(--border);
    color: var(--text-muted); cursor: pointer; transition: all .25s;
}
.guide-mode-tab:hover { border-color: rgba(41,151,255,.3); color: var(--text); }
.guide-mode-tab.active {
    background: rgba(41,151,255,.08); border-color: var(--gold);
    color: var(--gold);
}

/* â”€â”€â”€ Topic Quick Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.guide-topics { margin-bottom: 1.5rem; }
.guide-topics-title {
    font-family: 'Inter', sans-serif; font-size: .72rem;
    text-transform: uppercase; letter-spacing: .12em;
    color: var(--text-muted); font-weight: 600;
    margin-bottom: .65rem; padding-left: .2rem;
}
.guide-topic-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
    gap: .55rem;
}
.guide-topic {
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: var(--radius); padding: .75rem 1rem;
    cursor: pointer; transition: all .25s;
    display: flex; align-items: center; gap: .6rem;
}
.guide-topic:hover {
    border-color: rgba(41,151,255,.25); background: rgba(41,151,255,.03);
    transform: translateY(-1px);
}
.guide-topic-icon {
    width: 36px; height: 36px; border-radius: 50%;
    background: rgba(41,151,255,.08); border: 1px solid rgba(41,151,255,.15);
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0; font-size: .9rem;
}
.guide-topic-text { font-size: .85rem; font-weight: 600; color: var(--text); line-height: 1.3; }
.guide-topic-sub { font-size: .72rem; color: var(--text-muted); font-family: 'Inter', sans-serif; }

/* â”€â”€â”€ Intake Topics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.intake-topics { display: none; margin-bottom: 1.5rem; }
.intake-topics.visible { display: block; }
.intake-progress {
    display: flex; gap: .4rem; margin-bottom: 1.2rem;
    justify-content: center;
}
.intake-step {
    width: 32px; height: 4px; border-radius: 2px;
    background: var(--border); transition: background .3s;
}
.intake-step.done { background: var(--gold); }
.intake-step.current { background: var(--gold); opacity: .6; }
.intake-info {
    background: var(--bg-card); border: 1px solid rgba(41,151,255,.15);
    border-radius: var(--radius); padding: 1.2rem 1.5rem;
    margin-bottom: 1rem;
}
.intake-info h3 {
    font-size: 1rem; color: var(--gold); margin-bottom: .5rem;
}
.intake-info p {
    font-size: .9rem; color: var(--text-muted); line-height: 1.6;
}

/* â”€â”€â”€ Chat Area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.guide-chat-box {
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: var(--radius); max-height: 440px; overflow-y: auto;
    margin-bottom: 1rem; scroll-behavior: smooth;
}
.guide-messages { padding: 1rem; }
.guide-msg {
    display: flex; gap: .75rem; margin-bottom: 1rem;
    animation: guideMsgIn .3s ease;
}
@keyframes guideMsgIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
}
.guide-msg.user { flex-direction: row-reverse; }
.guide-msg-avatar {
    width: 34px; height: 34px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: .8rem; flex-shrink: 0; font-weight: 600;
    font-family: 'Inter', sans-serif;
}
.guide-msg.helios .guide-msg-avatar {
    background: rgba(41,151,255,.12); color: var(--gold);
}
.guide-msg.user .guide-msg-avatar {
    background: rgba(74,126,181,.12); color: var(--blue);
}
.guide-msg-body {
    max-width: 80%; padding: .75rem 1rem;
    border-radius: var(--radius); font-size: .92rem; line-height: 1.6;
}
.guide-msg.helios .guide-msg-body {
    background: rgba(41,151,255,.04); border: 1px solid rgba(41,151,255,.1);
}
.guide-msg.user .guide-msg-body {
    background: rgba(74,126,181,.08); border: 1px solid rgba(74,126,181,.12);
}
.guide-msg-body p { margin: 0; }
.guide-voice-btn {
    background: none; border: none; cursor: pointer;
    font-size: 1rem; margin-top: .4rem; padding: .2rem;
    opacity: .5; transition: opacity .2s;
}
.guide-voice-btn:hover { opacity: 1; }
.guide-voice-btn.playing { opacity: 1; color: var(--gold); }

/* â”€â”€â”€ Input Area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.guide-input-area {
    display: flex; gap: .5rem;
}
.guide-input-area input {
    flex: 1; padding: .7rem 1rem;
    background: var(--bg-card); border: 1px solid var(--border);
    border-radius: var(--radius); color: var(--text);
    font-size: .95rem; font-family: 'EB Garamond', serif;
}
.guide-input-area input:focus {
    outline: none; border-color: var(--gold);
    box-shadow: 0 0 0 2px rgba(41,151,255,.1);
}
.guide-input-area .btn { white-space: nowrap; }

/* â”€â”€â”€ Follow-ups â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.guide-followups {
    display: flex; flex-wrap: wrap; gap: .4rem;
    padding: 0 1rem .5rem;
}
.guide-follow-btn {
    background: var(--bg); border: 1px solid var(--border);
    border-radius: 16px; padding: .3rem .8rem;
    font-size: .75rem; color: var(--text-muted);
    cursor: pointer; transition: all .2s;
    font-family: 'Inter', sans-serif;
}
.guide-follow-btn:hover {
    border-color: var(--gold); color: var(--gold);
    background: rgba(41,151,255,.04);
}

/* â”€â”€â”€ Quick Links â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.guide-links {
    display: flex; flex-wrap: wrap; gap: .5rem;
    justify-content: center;
    margin-top: 1.5rem; padding: 1rem 0;
    border-top: 1px solid var(--border);
}
.guide-link {
    padding: .4rem .8rem; border-radius: 20px;
    font-size: .75rem; font-weight: 600;
    border: 1px solid var(--border); color: var(--text-muted);
    text-decoration: none; transition: all .2s;
    font-family: 'Inter', sans-serif;
}
.guide-link:hover { border-color: var(--gold); color: var(--gold); }

@media (max-width: 768px) {
    .guide-topic-grid { grid-template-columns: 1fr 1fr; }
    .guide-hero h1 { font-size: 1.7rem; }
}
@media (max-width: 480px) {
    .guide-topic-grid { grid-template-columns: 1fr; }
    .guide-avatar-ring { width: 130px; height: 130px; }
}
</style>
{% endblock %}

{% block content %}
<section class="section">
    <div class="container container-sm">

        <!-- â•â•â• HERO â•â•â• -->
        <div class="guide-hero">
            <h1>Meet <span>Helios</span></h1>
            <p class="guide-subtitle">
                Your personal guide to the protocol. I'm here to walk you through
                everything â€” how it works, where your money goes, and how to get
                started. Take your time. Ask anything. I'll explain it plainly.
            </p>
        </div>

        <!-- â•â•â• AVATAR â•â•â• -->
        <div class="guide-avatar-wrap">
            <div class="guide-avatar-ring" id="guideAvatar" onclick="guideAvatarTap()">
                <svg viewBox="0 0 180 180" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <radialGradient id="gaCoreGrad" cx="50%" cy="45%" r="40%">
                            <stop offset="0%" style="stop-color:#93c5fd"/>
                            <stop offset="60%" style="stop-color:#2997ff"/>
                            <stop offset="100%" style="stop-color:#0071e3"/>
                        </radialGradient>
                        <radialGradient id="gaGlow" cx="50%" cy="50%" r="50%">
                            <stop offset="0%" style="stop-color:#93c5fd;stop-opacity:0.6"/>
                            <stop offset="40%" style="stop-color:#2997ff;stop-opacity:0.3"/>
                            <stop offset="100%" style="stop-color:#1d4ed8;stop-opacity:0"/>
                        </radialGradient>
                        <filter id="gaBlur">
                            <feGaussianBlur stdDeviation="5" result="b"/>
                            <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
                        </filter>
                    </defs>
                    <!-- Outer glow -->
                    <circle cx="90" cy="90" r="80" fill="url(#gaGlow)" opacity=".25"/>
                    <!-- Concentric rings -->
                    <g class="ga-rings">
                        <circle cx="90" cy="90" r="70" fill="none" stroke="#2997ff" stroke-width="1.2" opacity=".2"/>
                        <circle cx="90" cy="90" r="55" fill="none" stroke="#64d2ff" stroke-width=".8" opacity=".15"/>
                        <circle cx="90" cy="90" r="40" fill="none" stroke="#0071e3" stroke-width=".6" opacity=".1" stroke-dasharray="6 5"/>
                    </g>
                    <!-- Rays -->
                    <g opacity=".3">
                        <line x1="90" y1="22" x2="90" y2="6" stroke="#64d2ff" stroke-width="2" stroke-linecap="round"/>
                        <line x1="90" y1="174" x2="90" y2="158" stroke="#64d2ff" stroke-width="2" stroke-linecap="round"/>
                        <line x1="22" y1="90" x2="6" y2="90" stroke="#64d2ff" stroke-width="2" stroke-linecap="round"/>
                        <line x1="174" y1="90" x2="158" y2="90" stroke="#64d2ff" stroke-width="2" stroke-linecap="round"/>
                        <line x1="42" y1="42" x2="30" y2="30" stroke="#64d2ff" stroke-width="1.5" stroke-linecap="round"/>
                        <line x1="138" y1="42" x2="150" y2="30" stroke="#64d2ff" stroke-width="1.5" stroke-linecap="round"/>
                        <line x1="42" y1="138" x2="30" y2="150" stroke="#64d2ff" stroke-width="1.5" stroke-linecap="round"/>
                        <line x1="138" y1="138" x2="150" y2="150" stroke="#64d2ff" stroke-width="1.5" stroke-linecap="round"/>
                    </g>
                    <!-- Core -->
                    <g filter="url(#gaBlur)">
                        <circle class="ga-core" cx="90" cy="90" r="22" fill="url(#gaCoreGrad)"/>
                    </g>
                    <!-- Helios "H" -->
                    <text x="90" y="97" text-anchor="middle" fill="#0c0f14" font-size="18" font-weight="700" font-family="'EB Garamond', serif" opacity=".6">H</text>
                </svg>
            </div>
            <div class="guide-persona-label" id="guideLabel">HELIOS</div>
            <div class="guide-persona-status" id="guideStatus">Your guide &middot; tap to listen</div>
        </div>

        <!-- â•â•â• VOICE TOGGLE â•â•â• -->
        <div class="guide-voice-bar">
            <div class="guide-voice-toggle">
                <span class="gv-label">Text</span>
                <div class="gv-switch on" id="guideVoiceSwitch" onclick="toggleGuideVoice()"></div>
                <span class="gv-label">Voice</span>
            </div>
        </div>

        <!-- â•â•â• MODE TABS â•â•â• -->
        <div class="guide-mode-tabs">
            <div class="guide-mode-tab active" id="tabLearn" onclick="setMode('learn')">Learn About Helios</div>
            <div class="guide-mode-tab" id="tabIntake" onclick="setMode('intake')">Get Started</div>
        </div>

        <!-- â•â•â• LEARN TOPICS â•â•â• -->
        <div class="guide-topics" id="learnTopics">
            <div class="guide-topics-title">What would you like to know?</div>
            <div class="guide-topic-grid">
                <div class="guide-topic" onclick="guideAsk('Can you explain what Helios is, in simple terms? What exactly am I joining?')">
                    <div class="guide-topic-icon">â˜€</div>
                    <div><div class="guide-topic-text">What is Helios?</div><div class="guide-topic-sub">The basics, plain and simple</div></div>
                </div>
                <div class="guide-topic" onclick="guideAsk('How does the smart contract allocation work? Walk me through where my activation fee actually goes.')">
                    <div class="guide-topic-icon">$</div>
                    <div><div class="guide-topic-text">Where does my money go?</div><div class="guide-topic-sub">Every dollar, every contract, accounted for</div></div>
                </div>
                <div class="guide-topic" onclick="guideAsk('What are gold-backed certificates? How do they work and what makes them valuable?')">
                    <div class="guide-topic-icon">ğŸ…</div>
                    <div><div class="guide-topic-text">Gold Certificates</div><div class="guide-topic-sub">Real gold, digital proof</div></div>
                </div>
                <div class="guide-topic" onclick="guideAsk('How does staking work in Helios? What are the lock periods and reward rates?')">
                    <div class="guide-topic-icon">ğŸ”’</div>
                    <div><div class="guide-topic-text">Staking & Rewards</div><div class="guide-topic-sub">Lock periods and rewards</div></div>
                </div>
                <div class="guide-topic" onclick="guideAsk('What blockchain technology does Helios use? Tell me about XRPL and Stellar.')">
                    <div class="guide-topic-icon">â›“</div>
                    <div><div class="guide-topic-text">The Technology</div><div class="guide-topic-sub">XRPL, Stellar, and Web3</div></div>
                </div>
                <div class="guide-topic" onclick="guideAsk('Is this safe? What protections are in place for members? How is the gold verified?')">
                    <div class="guide-topic-icon">ğŸ›¡</div>
                    <div><div class="guide-topic-text">Safety & Trust</div><div class="guide-topic-sub">Protections and verification</div></div>
                </div>
                <div class="guide-topic" onclick="guideAsk('Can you walk me through exactly how someone earns in Helios, step by step?')">
                    <div class="guide-topic-icon">ğŸ“Š</div>
                    <div><div class="guide-topic-text">How You Earn</div><div class="guide-topic-sub">Step-by-step allocation</div></div>
                </div>
                <div class="guide-topic" onclick="guideAsk('What is the .helios namespace? Will I get my own identity on the network?')">
                    <div class="guide-topic-icon">.h</div>
                    <div><div class="guide-topic-text">Your .helios Identity</div><div class="guide-topic-sub">Permanent on-chain name</div></div>
                </div>
            </div>
        </div>

        <!-- â•â•â• INTAKE TOPICS â•â•â• -->
        <div class="intake-topics" id="intakeTopics">
            <div class="intake-progress" id="intakeProgress">
                <div class="intake-step" data-step="1"></div>
                <div class="intake-step" data-step="2"></div>
                <div class="intake-step" data-step="3"></div>
                <div class="intake-step" data-step="4"></div>
                <div class="intake-step" data-step="5"></div>
            </div>
            <div class="intake-info">
                <h3>Let's Get You Started</h3>
                <p>I'll walk you through everything you need to know before joining.
                   No pressure â€” just information. We'll cover what Helios is, how the
                   allocation works, what you receive, and answer any questions you have.
                   When you're ready, I'll help you take the next step.</p>
            </div>
            <div class="guide-topic-grid">
                <div class="guide-topic" onclick="startIntakeStep(1)">
                    <div class="guide-topic-icon">1</div>
                    <div><div class="guide-topic-text">How the Money Works</div><div class="guide-topic-sub">3 ways you get paid</div></div>
                </div>
                <div class="guide-topic" onclick="startIntakeStep(2)">
                    <div class="guide-topic-icon">2</div>
                    <div><div class="guide-topic-text">Smart Contract Propagation</div><div class="guide-topic-sub">How allocations flow through the mesh</div></div>
                </div>
                <div class="guide-topic" onclick="startIntakeStep(3)">
                    <div class="guide-topic-icon">3</div>
                    <div><div class="guide-topic-text">Gold, Crypto & Real Assets</div><div class="guide-topic-sub">What you actually hold</div></div>
                </div>
                <div class="guide-topic" onclick="startIntakeStep(4)">
                    <div class="guide-topic-icon">4</div>
                    <div><div class="guide-topic-text">Your Questions</div><div class="guide-topic-sub">Ask me anything at all</div></div>
                </div>
                <div class="guide-topic" onclick="startIntakeStep(5)">
                    <div class="guide-topic-icon">5</div>
                    <div><div class="guide-topic-text">Select Your Contract</div><div class="guide-topic-sub">$100 to $5,000 â€” activate and go</div></div>
                </div>
            </div>
        </div>

        <!-- â•â•â• CHAT â•â•â• -->
        <div class="guide-chat-box" id="guideChatBox">
            <div class="guide-messages" id="guideMessages">
                <div class="guide-msg helios">
                    <div class="guide-msg-avatar">H</div>
                    <div class="guide-msg-body">
                        <p>Good to have you here. I'm Helios â€” think of me as your guide
                        through all of this.<br><br>
                        I've been helping people understand this protocol for a while now.
                        Whether you're just curious or ready to get started, I'm here to
                        walk you through it at your pace.<br><br>
                        <strong>Pick a topic above</strong>, or just type what's on your
                        mind. And if you'd rather listen than read â€” hit that voice toggle.
                        I'll talk you through it.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="guide-input-area">
            <input type="text" id="guideInput" placeholder="Ask me anything about Helios..."
                   autocomplete="off">
            <button id="guideSend" class="btn btn-primary">Ask</button>
        </div>

        <!-- â•â•â• PAGE LINKS â•â•â• -->
        <div class="guide-links">
            <a href="/earnings" class="guide-link">Allocation Model</a>
            <a href="/certificates" class="guide-link">Certificates</a>
            <a href="/treasury" class="guide-link">Treasury</a>
            <a href="/ask" class="guide-link">Technical Advisory</a>
            <a href="/activate" class="guide-link">Activate Your Contract</a>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
// â•â•â• Configuration â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var GUIDE_VOICE_ID = '2EiwWnXFnvU5JabPnv8n'; // Clyde â€” deep, warm, older male
var memberId = localStorage.getItem('helios_id') || null;
var guideMessages = document.getElementById('guideMessages');
var guideInput = document.getElementById('guideInput');
var guideSend = document.getElementById('guideSend');
var guideAvatar = document.getElementById('guideAvatar');
var guideLabel = document.getElementById('guideLabel');
var guideStatus = document.getElementById('guideStatus');

var currentAudio = null;
var lastGuideAnswer = null;
var guideVoiceOn = true;
var currentMode = 'learn';
var intakeStep = 0;

// â•â•â• Voice Toggle â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleGuideVoice() {
    var sw = document.getElementById('guideVoiceSwitch');
    guideVoiceOn = !guideVoiceOn;
    sw.classList.toggle('on', guideVoiceOn);
    guideStatus.textContent = guideVoiceOn
        ? 'Voice active â€” I\'ll speak my answers'
        : 'Text-only mode';
}

// â•â•â• Mode Switching â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setMode(mode) {
    currentMode = mode;
    document.getElementById('tabLearn').classList.toggle('active', mode === 'learn');
    document.getElementById('tabIntake').classList.toggle('active', mode === 'intake');
    document.getElementById('learnTopics').style.display = mode === 'learn' ? 'block' : 'none';
    document.getElementById('intakeTopics').classList.toggle('visible', mode === 'intake');
    if (mode === 'intake' && intakeStep === 0) {
        updateIntakeProgress(0);
    }
}

// â•â•â• Intake Progress â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var intakeQuestions = [
    "Let me break down the three allocation channels. Real simple.\n\n" +
    "First \u2014 direct connection allocation. Every member you personally connect generates an " +
    "immediate allocation. At the $100 contract, that's $22.50 per member. At $1,000 contract, that's $225. " +
    "At $5,000 contract, that's $1,125. Per member. Connect a few members and you've already received your first allocation.\n\n" +
    "Second \u2014 the smart contract engine. Every membership sends 45% into a pool that distributes to " +
    "you every time someone joins anywhere in your connection mesh. Your connections connect more, " +
    "and the mesh grows organically. Small per member, substantial when the network grows.\n\n" +
    "Third \u2014 gold, NFTs, and crypto. Part of every membership buys physical gold. " +
    "You can convert your certificates into BTC, ETH, XRP, stablecoins, or actual metal. " +
    "Your allocations are backed by real assets, not points.\n\n" +
    "One payment. No recurring fees. Just math and smart contracts.\n\n" +
    "Want me to show you how allocations propagate \u2014 how they flow through the connection mesh?",

    "Here's how smart contract propagation works. Think of it like signal flowing through a mesh.\n\n" +
    "When someone activates a contract, the smart contract distributes allocations outward " +
    "through the connection graph. Each hop reduces the allocation by a decay factor \u2014 " +
    "Depth 1 gets 50%, Depth 2 gets 25%, Depth 3 gets 12.5%, and so on.\n\n" +
    "The person who made the direct connection receives the largest allocation. " +
    "Members further up the chain receive progressively smaller amounts \u2014 but they receive " +
    "from every activation in their mesh, not just direct connections.\n\n" +
    "With a growing mesh on the $100 contract:\n\n" +
    "Direct connectors earn the most per member.\n" +
    "Upstream members earn less per member but from more activations.\n" +
    "The formula is deterministic \u2014 W_h = W_1 \u00b7 r^(h-1). No discretion. Pure math.\n\n" +
    "Want me to walk you through the gold and crypto side?",

    "Every membership buys physical gold. As the protocol grows, gold purchases scale proportionally. " +
    "That's real metal in a vault, not numbers on a screen.\n\n" +
    "You receive gold-backed NFTs \u2014 digital certificates that represent actual gold weight. " +
    "You can redeem them for physical gold, physical silver, or convert to stablecoins.\n\n" +
    "You also get access to BTC, ETH, XRP, XLM, USDC, and USDT. " +
    "Build wealth across multiple asset classes, not just one.\n\n" +
    "On top of that, you can stake your certificates:\n" +
    "30 days = +5% reward\n" +
    "90 days = +12% reward\n" +
    "180 days = +20% reward\n" +
    "365 days = +30% reward\n\n" +
    "Lock your certificates, earn reward allocations on top of everything else. " +
    "Staking rewards compound on top of your base allocations.\n\n" +
    "Any questions before we talk about getting you started?",

    "This is your space. Ask me anything you want to know. " +
    "Whether it's about the math, the gold, the crypto, the tiers, the risks, " +
    "how the formula works, what happens to your money \u2014 anything at all.\n\n" +
    "I'd rather you ask now than wonder later. There's no such thing as a dumb question here. " +
    "What's on your mind?",

    "If you're ready, here's the move.\n\n" +
    "Select your contract: $100, $250, $500, $1,000, or $5,000. " +
    "Higher contract means bigger allocation pool, bigger direct connection allocations, " +
    "and more gold and crypto access.\n\n" +
    "One payment. No recurring fees. No re-qualifying.\n\n" +
    "You get your .helios identity, your first certificate allocation, " +
    "and full access to the protocol \u2014 including crypto tools and the AI guide.\n\n" +
    "Share with your connections. " +
    "Let the smart contracts do the rest.\n\n" +
    "<a href='/activate' style='color:var(--gold);font-weight:600;'>\u2192 Select Your Contract</a> &nbsp; " +
    "<a href='/opportunity' style='color:var(--gold);font-weight:600;'>\u2192 See the Full Breakdown</a>"
];

function updateIntakeProgress(step) {
    var steps = document.querySelectorAll('.intake-step');
    steps.forEach(function(s, i) {
        s.classList.remove('done', 'current');
        if (i < step) s.classList.add('done');
        if (i === step) s.classList.add('current');
    });
}

function startIntakeStep(step) {
    intakeStep = step;
    updateIntakeProgress(step - 1);
    var msg = intakeQuestions[step - 1];
    addGuideMsg('helios', msg, true);
    if (guideVoiceOn) {
        speakGuide(null, msg);
    }
}

// â•â•â• Avatar State â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setGuideState(state) {
    guideAvatar.classList.remove('speaking', 'thinking');
    var label = document.getElementById('guideLabel');
    if (state === 'speaking') {
        guideAvatar.classList.add('speaking');
        label.textContent = 'SPEAKING';
        label.classList.add('active');
        guideStatus.textContent = 'Tap to pause';
    } else if (state === 'thinking') {
        guideAvatar.classList.add('thinking');
        label.textContent = 'THINKING';
        label.classList.remove('active');
        guideStatus.textContent = '';
    } else {
        label.textContent = 'HELIOS';
        label.classList.remove('active');
        guideStatus.textContent = guideVoiceOn
            ? (lastGuideAnswer ? 'Tap to hear again' : 'Voice active')
            : 'Text-only mode';
    }
}

function guideAvatarTap() {
    if (currentAudio) {
        currentAudio.pause();
        currentAudio = null;
        setGuideState('idle');
        return;
    }
    if (lastGuideAnswer && guideVoiceOn) {
        speakGuide(null, lastGuideAnswer);
    }
}

// â•â•â• Chat Functions â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addGuideMsg(role, text, showVoice) {
    var div = document.createElement('div');
    div.className = 'guide-msg ' + role;

    var voiceHtml = '';
    if (role === 'helios' && showVoice && guideVoiceOn) {
        voiceHtml = '<button class="guide-voice-btn" title="Listen">&#128266;</button>';
    }

    div.innerHTML =
        '<div class="guide-msg-avatar">' + (role === 'helios' ? 'H' : 'Y') + '</div>' +
        '<div class="guide-msg-body">' +
            '<p>' + text.replace(/\n/g, '<br>') + '</p>' +
            voiceHtml +
        '</div>';

    if (role === 'helios' && showVoice) {
        lastGuideAnswer = text;
        var vBtn = div.querySelector('.guide-voice-btn');
        if (vBtn) {
            vBtn.addEventListener('click', function() { speakGuide(this, text); });
        }
    }

    guideMessages.appendChild(div);
    guideMessages.scrollTop = guideMessages.scrollHeight;
    document.getElementById('guideChatBox').scrollIntoView({ behavior: 'smooth', block: 'end' });
}

async function speakGuide(btn, text) {
    if (currentAudio) {
        currentAudio.pause();
        currentAudio = null;
        document.querySelectorAll('.guide-voice-btn.playing').forEach(function(b) {
            b.classList.remove('playing'); b.innerHTML = '&#128266;';
        });
        setGuideState('idle');
        return;
    }

    if (btn) { btn.classList.add('playing'); btn.innerHTML = '&#8987;'; }
    setGuideState('speaking');

    try {
        var res = await fetch('/api/voice/speak', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text: text, voice_id: GUIDE_VOICE_ID })
        }).then(function(r) { return r.json(); });

        if (res.success && res.data && res.data.audio) {
            var audioData = 'data:audio/mpeg;base64,' + res.data.audio;
            currentAudio = new Audio(audioData);
            if (btn) btn.innerHTML = '&#9208;&#65039;';

            currentAudio.onended = function() {
                if (btn) { btn.classList.remove('playing'); btn.innerHTML = '&#128266;'; }
                currentAudio = null;
                setGuideState('idle');
            };
            currentAudio.onerror = function() {
                if (btn) { btn.classList.remove('playing'); btn.innerHTML = '&#128266;'; }
                currentAudio = null;
                setGuideState('idle');
            };
            currentAudio.play();
        } else {
            if (btn) { btn.classList.remove('playing'); btn.innerHTML = '&#128263;'; setTimeout(function() { btn.innerHTML = '&#128266;'; }, 2000); }
            setGuideState('idle');
        }
    } catch (err) {
        if (btn) { btn.classList.remove('playing'); btn.innerHTML = '&#128263;'; setTimeout(function() { btn.innerHTML = '&#128266;'; }, 2000); }
        setGuideState('idle');
    }
}

async function guideAsk(question) {
    if (!question.trim()) return;

    addGuideMsg('user', question);
    guideInput.value = '';
    setGuideState('thinking');

    var typing = document.createElement('div');
    typing.className = 'guide-msg helios typing';
    typing.innerHTML = '<div class="guide-msg-avatar">H</div><div class="guide-msg-body"><p>Let me think on that...</p></div>';
    guideMessages.appendChild(typing);
    guideMessages.scrollTop = guideMessages.scrollHeight;

    try {
        var res = await fetch('/api/chat/ask', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ question: question, member_id: memberId })
        }).then(function(r) { return r.json(); });

        typing.remove();
        setGuideState('idle');

        if (res.success) {
            addGuideMsg('helios', res.data.answer, true);

            if (res.data.follow_up && res.data.follow_up.length > 0) {
                var followups = document.createElement('div');
                followups.className = 'guide-followups';
                followups.innerHTML = res.data.follow_up.map(function(q) {
                    return '<button class="guide-follow-btn" onclick="guideAsk(\'' + q.replace(/'/g, "\\'") + '\')">' + q + '</button>';
                }).join('');
                guideMessages.appendChild(followups);
                guideMessages.scrollTop = guideMessages.scrollHeight;
            }

            if (guideVoiceOn) {
                speakGuide(null, res.data.answer);
            }
        } else {
            addGuideMsg('helios', 'I wasn\'t able to process that just now. Could you try asking again?');
        }
    } catch(err) {
        typing.remove();
        setGuideState('idle');
        addGuideMsg('helios', 'Having a little trouble connecting right now. Give it another try in a moment.');
    }
}

// â•â•â• Event Listeners â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
guideSend.addEventListener('click', function() { guideAsk(guideInput.value); });
guideInput.addEventListener('keypress', function(e) { if (e.key === 'Enter') guideAsk(guideInput.value); });

// â•â•â• Auto-greet with voice â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
    var greeted = sessionStorage.getItem('helios_guide_greeted');
    if (!greeted && guideVoiceOn) {
        sessionStorage.setItem('helios_guide_greeted', '1');
        setTimeout(function() {
            var intro = "Good to have you here. I'm Helios. Think of me as your guide " +
                "through all of this. Whether you're just curious or ready to get started, " +
                "I'm here to walk you through it at your pace. Pick a topic, or just ask " +
                "me whatever's on your mind.";
            speakGuide(null, intro);
        }, 1500);
    }
})();
</script>
{% endblock %}
